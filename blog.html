<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TEAM VAJRA - Drone Club | Blog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/assets/club-logo.jpg">
    <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Lexend Font -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand-maroon: #800000;
      --brand-yellow: #f7c275;
      --text-light: #ffffff;
      --text-muted: #e0e0e0;
      --bg-dark: #050608;
      --bg-card: #111318;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Lexend', sans-serif;
    }

    body {
      color: var(--text-light);
      overflow-x: hidden;
      background-image:
        linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.95)),
        url("assets/blog-bg-drones.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    /* ===== Header ===== */
    .header {
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      border-bottom: 2px solid var(--brand-maroon);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand img {
      height: 50px;
      border-radius: 8px;
    }

    .title {
      font-size: 1.3em;
      font-weight: 700;
      color: var(--brand-yellow);
    }

    .nav a {
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      color: #fff;
      transition: color 0.3s, border-bottom 0.3s;
    }

    .nav a:hover {
      color: var(--brand-yellow);
      border-bottom: 2px solid var(--brand-yellow);
    }

    .nav a.active {
      color: var(--brand-yellow);
      border-bottom: 2px solid var(--brand-yellow);
    }

    /* ===== Page Wrapper ===== */
    .page-wrap {
      max-width: 1100px;
      margin: 40px auto 60px;
      padding: 0 20px;
    }

    .page-title {
      margin-bottom: 26px;
    }

    .page-title h1 {
      font-size: 2.1rem;
      color: var(--brand-yellow);
      margin-bottom: 6px;
    }

    .page-title p {
      color: var(--text-muted);
      font-size: 0.96rem;
    }

    /* ===== Featured Card (preview) ===== */
    .featured-label {
      font-size: 0.8rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .featured-card {
      background: rgba(7, 8, 12, 0.98);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.85);
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      min-height: 260px;
    }

    .featured-image {
      position: relative;
      overflow: hidden;
    }

    .featured-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform 0.4s ease;
    }

    .featured-card:hover .featured-image img {
      transform: scale(1.06);
    }

    .featured-content {
      padding: 22px 26px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: linear-gradient(135deg, #10121a, #08090e);
    }

    .featured-meta {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .featured-title {
      font-size: 1.55rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 10px;
    }

    .featured-title span {
      color: var(--brand-yellow);
    }

    .featured-excerpt {
      font-size: 0.92rem;
      color: var(--text-muted);
      line-height: 1.7;
    }

    .card-bottom {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      border-top: 1px solid rgba(247, 194, 117, 0.22);
      padding-top: 10px;
    }

    .card-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.82rem;
    }

    .card-actions button,
    .card-actions a {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      color: var(--text-muted);
      text-decoration: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: color 0.2s;
      font-size: 0.82rem;
    }

    .card-actions button:hover,
    .card-actions a:hover {
      color: var(--brand-yellow);
    }

    .card-actions button.liked {
      color: var(--brand-yellow);
      font-weight: 600;
    }

    .read-more-link {
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .read-more-link button {
      background: none;
      border: none;
      color: var(--brand-yellow);
      cursor: pointer;
      font-size: inherit;
      font-weight: inherit;
      letter-spacing: inherit;
    }

    .read-more-link button:hover {
      text-decoration: underline;
    }

    .like-count-card {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* ===== Full Blog Article ===== */
    .blog-post {
      margin-top: 30px;
      background: rgba(5, 6, 10, 0.96);
      border-radius: 14px;
      padding: 22px 24px;
      border: 1px solid rgba(247, 194, 117, 0.25);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.9);
      display: none; /* hidden until Read More */
    }

    .blog-post h2 {
      color: var(--brand-yellow);
      margin-bottom: 6px;
      font-size: 1.4rem;
    }

    .blog-meta {
      margin-bottom: 10px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    /* MEDIUM-SIZE IMAGE INSIDE BLOG */
    .blog-image-inline {
      display: block;
      width: 100%;
      max-width: 480px;       /* medium width */
      border-radius: 12px;
      margin: 10px auto 18px; /* centered */
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.9);
    }

    .blog-post p {
      margin-bottom: 10px;
      color: var(--text-muted);
      line-height: 1.7;
      font-size: 0.95rem;
    }

    .blog-post ul,
    .blog-post ol {
      margin-left: 1.2rem;
      margin-bottom: 10px;
      color: var(--text-muted);
      font-size: 0.93rem;
      line-height: 1.7;
    }

    .blog-post h3 {
      margin-top: 10px;
      margin-bottom: 6px;
      font-size: 1.05rem;
      color: var(--brand-yellow);
    }

    /* ===== Engagement Bar (inside article) ===== */
    .engagement-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 18px;
      padding-top: 12px;
      border-top: 1px solid rgba(247, 194, 117, 0.3);
    }

    .engagement-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .engagement-buttons button {
      border-radius: 999px;
      border: 1px solid rgba(247, 194, 117, 0.6);
      background: transparent;
      color: var(--text-light);
      padding: 6px 14px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s, border-color 0.2s;
    }

    .engagement-buttons button:hover {
      background: rgba(247, 194, 117, 0.14);
      border-color: var(--brand-yellow);
      transform: translateY(-1px);
    }

    .engagement-buttons button.liked {
      background: var(--brand-yellow);
      color: #000;
      border-color: var(--brand-yellow);
    }

    .like-count {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    /* ===== Comments ===== */
    .comments-section {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed rgba(247, 194, 117, 0.35);
    }

    .comments-section h4 {
      font-size: 1rem;
      margin-bottom: 6px;
      color: var(--brand-yellow);
    }

    .comment-form textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 10px;
      border: 1px solid rgba(247, 194, 117, 0.4);
      background: rgba(0, 0, 0, 0.75);
      color: var(--text-light);
      padding: 8px 10px;
      font-size: 0.9rem;
      resize: vertical;
    }

    .comment-form button {
      margin-top: 6px;
      border-radius: 999px;
      border: none;
      background: var(--brand-maroon);
      color: #fff;
      padding: 6px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .comment-form button:hover {
      background: var(--brand-yellow);
      color: #000;
      transform: translateY(-1px);
    }

    .comment-list {
      list-style: none;
      margin-top: 10px;
    }

    .comment-list li {
      padding: 6px 8px;
      margin-bottom: 6px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.04);
      font-size: 0.88rem;
      color: var(--text-muted);
    }

    .comment-timestamp {
      display: block;
      font-size: 0.72rem;
      color: rgba(224, 224, 224, 0.7);
      margin-top: 2px;
    }

    .back-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 0.84rem;
    }

    .back-to-top a,
    .read-less button {
      color: var(--brand-yellow);
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: none;
      font-size: inherit;
    }

    .back-to-top a:hover,
    .read-less button:hover {
      text-decoration: underline;
    }

    /* ===== Footer ===== */
    footer {
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding-top: 30px;
      border-top: 2px solid var(--brand-maroon);
    }

    .footer-main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 40px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 30px;
    }

    .footer-column {
      flex: 1 1 250px;
    }

    .footer-column h4 {
      color: var(--brand-yellow);
      margin-bottom: 10px;
    }

    .footer-column p,
    .footer-column a {
      color: var(--text-muted);
      font-size: 14px;
      text-decoration: none;
      line-height: 1.6;
    }

    .footer-column a:hover {
      color: var(--brand-yellow);
    }

    .footer-bottom {
      text-align: center;
      padding: 12px;
      font-size: 13px;
    }

    .social-links img {
      height: 32px;
      margin-right: 10px;
      transition: transform 0.3s;
      filter: brightness(90%);
    }

    .social-links img:hover {
      transform: scale(1.1);
      filter: brightness(110%);
    }

    /* ===== Responsive ===== */
    @media (max-width: 900px) {
      .featured-card {
        grid-template-columns: 1fr;
      }

      .featured-image {
        max-height: 260px;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <div class="brand">
        <img src="/assets/club-logo.jpg" alt="Team Vajra logo">
        <div>
          <div class="title">TEAM VAJRA</div>
          <div style="font-size:12px;color:var(--text-muted)">Drone Club ¬∑ MMCOE</div>
        </div>
      </div>
      <a href="/index.html">Home</a>
      <a href="/achievements.html">Achievements</a>
      <a href="/drones.html">Drones</a>
      <a href="/gallery.html">Gallery</a>
      <a href="/team.html">Team</a>
      <a href="/blog.html" class="active">Blogs</a>
       <a href="/contact.html">Contact</a>
    </div>
  </header>

  <main class="page-wrap" id="top">
    <div class="page-title">
      <h1>Flight Path: The Official Team Vajra Blog</h1>
      <p>Race recaps, build logs, and behind-the-scenes stories from the Team Vajra hangar.</p>
    </div>

    <!-- FEATURED label + card preview -->
    <div class="featured-label">Featured</div>
    <section class="featured-card">
      <div class="featured-image">
        <img src="assets/sky-no-limit-medals.jpg" alt="Team Vajra members holding medals in a circle">
      </div>
      <div class="featured-content">
        <div>
          <div class="featured-meta">December 2025 ¬∑ Race Recap ¬∑ Technoxian 9.0</div>
          <div class="featured-title">
            <span>The Sky's No Limit:</span> How VAJRA Flew to World Rank 3
          </div>
          <p class="featured-excerpt">
            A wild idea, countless test flights, late-night rebuilds, and a team that refused to quit ‚Äî
            this is how VAJRA went from a campus drone club to securing All India Rank 2 and
            World Rank 3 at TechnoXian 9.0. Here‚Äôs the journey behind those medals and what it
            really took to stand on the global podium.
          </p>
        </div>

        <div class="card-bottom">
          <div>
            <div class="like-count-card">
              <span id="like-count-card">0</span> likes
            </div>
            <div class="card-actions">
              <button id="like-btn-card">‚ù§Ô∏è Like</button>
              <a href="javascript:void(0);" id="share-link-card">Share</a>
              <a href="javascript:void(0);" id="comment-link-card">Post a Comment</a>
            </div>
          </div>
          <div class="read-more-link">
            <button id="read-more-btn">READ MORE</button>
          </div>
        </div>
      </div>
    </section>

    <!-- FULL BLOG (hidden at first) -->
    <article class="blog-post" id="full-blog">
      <h2>The Sky's No Limit: How VAJRA Flew to World Rank 3</h2>
      <div class="blog-meta">Published: December 2025 ¬∑ Category: Race Recap</div>

      <img src="assets/winner.jpg"
           alt="Team VAJRA members holding their medals in a circle"
           class="blog-image-inline">

      <p>
        What happens when a crazy idea meets pure grit? You get VAJRA. We're not just some
        drone club; we're a family of dreamers, builders, and flyers who believe the sky is
        our playground. At VAJRA, "innovation" means endless coffee-fueled nights, countless
        test flights (and crashes!), a ton of hard work, and that electric rush when our
        creations finally soar.
      </p>

      <p>
        For us, TechnoXian 2025 wasn't just another competition. It was our chance to show the
        world what we stand for: crazy teamwork, raw passion, and unyielding creativity.
        Through sheer determination, we made our mark on one of the planet's toughest drone
        competitions, proudly nabbing <strong>All India Rank 2</strong> and an incredible
        <strong>World Rank 3</strong>.
      </p>

      <h3>TechnoXian: The Olympics of Robotics and Drones</h3>
      <p>
        TechnoXian, run by the All India Council for Robotics and Automation (AICRA), is
        basically the Olympics for robotics and drones. It brings together innovators,
        hobbyists, and pros from everywhere to push the limits in wild categories. We threw
        ourselves into every challenge:
      </p>
      <ul>
        <li>Drone Racing FPV Challenge</li>
        <li>Search and Rescue Mission</li>
        <li>Payload Delivery and Drone Soccer</li>
      </ul>

      <h3>Our Journey: Scrapes, Setbacks, and Soaring Success</h3>
      <p>
        Securing World Rank 3 definitely didn't happen overnight. For months, our lives were
        all about drones. We obsessed over making them lightweight and aerodynamic, fine-tuning
        every line of code for agility and stability. We tested, crashed, rebuilt, and
        collaborated until we were blue in the face. We learned from every single failure and
        celebrated every tiny breakthrough.
      </p>

      <h3>Making of Champions: A Real-World Grind</h3>
      <p>
        Building elite drones from basic parts is the ultimate test of smarts and toughness.
        Our team dedicated months of their lives to this international stage‚Äîfrom convincing
        sponsors to designing our own jerseys.
      </p>
      <p>
        We hit countless roadblocks: broken parts, late-night rebuilds, and a lot of
        frustration. But every challenge just made us more determined. The result? Our AIR 2
        and World Rank 3 trophies are a testament to that grind. Every sleepless night, every
        snapped propeller, every dead battery, and every successful flight forged our resolve
        to make it on the global stage.
      </p>

      <h3>What Makes Us, Us?</h3>
      <p>
        At VAJRA, we don't just assemble drones; we build an experience that perfectly blends
        technical skill with genuine camaraderie. Our passion and unity set us apart. We fly
        not just to compete, but to represent the heart and spirit of our team.
      </p>
      <p>
        With amazing guidance from our experienced seniors and faculty, we're constantly
        raising the bar for the next generation.
      </p>

      <h3>The Future is Bright</h3>
      <p>
        Our win at TechnoXian 9.0 isn't just a shiny medal; it's a launchpad for the future.
        The enthusiasm of our juniors, guided by the wisdom of our seniors, shows the growing
        strength of our "family." This momentum fuels our ambition to keep innovating, push the
        boundaries of drone tech, and proudly represent our institution globally.
      </p>
      <p>
        For prospective members, VAJRA is more than a club. It's a home where curiosity meets
        opportunity and passion becomes a superpower. Whether you're a total newbie or a tech
        whiz, you're welcome here.
      </p>
      <p>
        To all our supporters, friends, and fellow drone enthusiasts, stay tuned for what's
        next! Follow our journey as we share behind-the-scenes moments, technical insights, and
        the pure excitement of competition.
      </p>
      <p>
        Together, we'll soar higher and redefine what's possible in the skies.
      </p>
      <!-- Like / Share inside article -->
      <div class="engagement-bar">
        <div class="engagement-buttons">
          <button id="like-btn-full">‚ù§Ô∏è Like</button>
          <button id="share-btn-full">üîó Share</button>
        </div>
        <div class="like-count">
          <span id="like-count-full">0</span> likes
        </div>
      </div>

      <!-- COMMENTS SECTION WITH GOOGLE LOGIN -->
      <div class="comments-section" id="comments">
        <h4>Comments</h4>

        <!-- Google Login UI -->
        <div id="google-login-area" style="margin-bottom:10px;">
          <div id="g_id_onload"
               data-client_id="637285193188-j0ktfqilttgeprj790mej890h417mk6q.apps.googleusercontent.com"
               data-callback="onGoogleSignIn"
               data-auto_prompt="false">
          </div>

          <div class="g_id_signin"
               data-type="standard"
               data-size="medium"
               data-theme="filled_black"
               data-text="Sign in with Google"
               data-shape="pill">
          </div>
        </div>

        <p id="user-status" style="font-size:14px;color:#f7c275;margin-top:5px;">
          Not logged in
        </p>

        <form class="comment-form" id="comment-form">
          <textarea id="comment-input" placeholder="Share your thoughts about this flight..."></textarea>
          <button type="submit">Post Comment</button>
        </form>

        <ul class="comment-list" id="comment-list"></ul>
      </div>

      <div class="back-row">
        <div class="back-to-top">
          <a href="#top">‚Üë Back to top</a>
        </div>
        <div class="read-less">
          <button id="read-less-btn">READ LESS</button>
        </div>
      </div>
    </article>
  </main>

 <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-main">
      <div class="footer-column branding">
        <h4>TEAM VAJRA-RC Drone Club MMCOE</h4>
        <p>At team Vajra, we aim to cater to industrial and social needs by developing skilled manpower in drone technology.</p>
      </div>

      <div class="footer-column contact">
        <h4>Contact Us</h4>
        <address>
          <p><strong>Email:</strong> <a href="mailto:teamvajra_rc@mmcoe.edu.in">teamvajra_rc@mmcoe.edu.in</a></p>
          <p><strong>Phone:</strong> Tanisha K.: +91 9307832052</p>
          <p><strong>Phone:</strong> Omkar B.: +91 7058819104</p>
        </address>
      </div>

      <div class="footer-column social">
        <h4>Follow Us</h4>
        <div class="social-links">
          <a href="https://www.instagram.com/teamvajra_mmcoe/" target="_blank"><img src="assets/insta-logo.png" alt="Instagram"></a>
          <a href="https://in.linkedin.com/company/team-vajra-mmcoe" target="_blank"><img src="assets/linkedin-logo.png" alt="LinkedIn"></a>
        </div>
        <p><strong>Location:</strong><br>Sr.No. 18, Plot No. 5/3, CTS No.205, Behind Vandevi Temple, Karve Nagar, Pune 411052, Maharashtra, India.</p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>¬© 2025 TEAM VAJRA. All Rights Reserved.</p>
    </div>
  </footer>



  <!-- Firebase + Firestore module: handles real-time likes & comments -->
<script type="module">
  // Diagnostic banner so we know the module script runs
  console.log("üî• Firebase module script loaded");

  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import {
    getFirestore, doc, getDoc, setDoc,
    collection, addDoc, onSnapshot, query, orderBy, runTransaction
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  import {
    getAuth,
    signInWithCredential,
    GoogleAuthProvider,
    onAuthStateChanged,
    signOut as firebaseSignOut
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

  // ---------- FIREBASE CONFIG ----------
  const firebaseConfig = {
    apiKey: "AIzaSyChvColRVokPBbAOiXv8P26ScRyDxPJI2w",
    authDomain: "team-vajra.firebaseapp.com",
    projectId: "team-vajra",
    storageBucket: "team-vajra.firebasestorage.app",
    messagingSenderId: "865557876116",
    appId: "1:865557876116:web:9f0ee78cee3c157df75381",
    measurementId: "G-TN5CL22RSH"
  };
  // -------------------------------------

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Debug helper
  function log(...args) { console.log("[VAJRA DEBUG]", ...args); }

  // Mirror Firebase Auth state to window.loggedUser and UI
  onAuthStateChanged(auth, (user) => {
    const statusEl = document.getElementById("user-status");
    if (user) {
      window.loggedUser = {
        name: user.displayName || null,
        email: user.email || null,
        picture: user.photoURL || null,
        uid: user.uid
      };
      if (statusEl) statusEl.innerHTML = "Logged in as <b>" + (user.displayName || user.email) + "</b>";
      log("Firebase Auth signed in:", window.loggedUser);
      // notify rest of app
      window.dispatchEvent(new Event('vajra:auth-changed'));
    } else {
      window.loggedUser = null;
      if (statusEl) statusEl.innerHTML = "Not logged in";
      log("Firebase Auth signed out");
      window.dispatchEvent(new Event('vajra:auth-changed'));
    }
  });

  // Exchange GSI token into Firebase Auth
  // GSI calls global: window.onGoogleSignIn(response)
  window.onGoogleSignIn = async function (response) {
    try {
      if (!response || !response.credential) {
        console.error("[VAJRA] GSI response missing credential", response);
        return;
      }
      log("GSI credential received ‚Äî exchanging for Firebase credential...");
      const idToken = response.credential;
      const firebaseCred = GoogleAuthProvider.credential(idToken);
      await signInWithCredential(auth, firebaseCred);
      log("[VAJRA] Signed in to Firebase using GSI token.");
    } catch (err) {
      console.error("[VAJRA ERROR] signInWithCredential failed:", err);
      // As a fallback, try to decode token for UI (non-Firebase). This keeps UI responsive but won't satisfy Firestore rules.
      try {
        const payload = JSON.parse(atob(response.credential.split(".")[1]));
        window.loggedUser = { name: payload.name, email: payload.email, picture: payload.picture };
        const status = document.getElementById("user-status");
        if (status) status.innerHTML = "Logged in as <b>" + (window.loggedUser.name || window.loggedUser.email) + "</b>";
        window.dispatchEvent(new Event('vajra:auth-changed'));
      } catch (e) {
        console.error("Fallback decode failed", e);
      }
      alert("Sign-in failed. Check console for details.");
    }
  };

  // Optional sign out for debugging
  window.vajraSignOut = async function () {
    try {
      await firebaseSignOut(auth);
      log("[VAJRA] user signed out.");
    } catch (err) {
      console.error("[VAJRA ERROR] signOut failed:", err);
    }
  };

  // ---------- POST IDENTIFIER ----------
  const POST_ID = "technoXian_9_world_rank_3";

  // DOM elements
  const likeBtnCard   = document.getElementById("like-btn-card");
  const likeBtnFull   = document.getElementById("like-btn-full");
  const likeCountCard = document.getElementById("like-count-card");
  const likeCountFull = document.getElementById("like-count-full");

  const commentForm   = document.getElementById("comment-form");
  const commentInput  = document.getElementById("comment-input");
  const commentList   = document.getElementById("comment-list");

  const commentLinkCard = document.getElementById("comment-link-card");
  const commentsSection = document.getElementById("comments");
  const fullBlog = document.getElementById("full-blog");

  // Firestore refs
  const likesDocRef = doc(db, "blogMeta", POST_ID); // stores { count: number }
  const userLikesCollection = (userIdEncoded) => doc(db, "blogMeta", POST_ID, "userLikes", userIdEncoded);
  const commentsCollectionRef = collection(db, "blogComments_" + POST_ID);

  // UTIL: encode user id (email) for doc ID
  function encEmail(e) {
    return encodeURIComponent(e).replace(/\./g, '%2E');
  }

  // DIAGNOSTIC initLikes() with error callbacks
  async function initLikes() {
    try {
      log("initLikes starting...");
      const snap = await getDoc(likesDocRef);
      log("getDoc(likesDocRef) exists?", snap.exists());
      if (!snap.exists()) {
        log("likesDoc absent ‚Äî creating with count:0");
        await setDoc(likesDocRef, { count: 0 });
      }

      // Real-time listener with error callback
      onSnapshot(likesDocRef, (s) => {
        if (s.exists()) {
          const data = s.data();
          const c = data.count || 0;
          if (likeCountCard) likeCountCard.textContent = c;
          if (likeCountFull) likeCountFull.textContent = c;
          log("onSnapshot: likes count", c);
        } else {
          log("onSnapshot: doc not found");
        }
      }, (error) => {
        console.error("[VAJRA ERROR] likes onSnapshot failed:", error);
        alert("Realtime likes listener failed: " + (error && error.message || error));
      });

      // If user already signed-in, update their like UI
      window.addEventListener('vajra:auth-changed', updateUserLikeUI);
      updateUserLikeUI();
    } catch (err) {
      console.error("[VAJRA ERROR] initLikes failed:", err);
      alert("Failed to initialize likes (check console).");
    }
  }

  // Update the like button state for current signed-in user (if any)
  async function updateUserLikeUI() {
    try {
      const user = window.loggedUser;
      if (!user || !user.email) {
        if (likeBtnCard) likeBtnCard.classList.remove("liked");
        if (likeBtnFull) likeBtnFull.classList.remove("liked");
        return;
      }
      const id = encEmail(user.email);
      const userLikeDoc = userLikesCollection(id);
      const s = await getDoc(userLikeDoc);
      const liked = s.exists();
      if (likeBtnCard) likeBtnCard.classList.toggle("liked", liked);
      if (likeBtnFull) likeBtnFull.classList.toggle("liked", liked);
      log("updateUserLikeUI ‚Äî liked:", liked);
    } catch (err) {
      console.error("[VAJRA ERROR] updateUserLikeUI failed:", err);
    }
  }

  // Toggle like (requires Firebase-authenticated user)
  async function toggleLikeFirestore() {
    const user = window.loggedUser;
    if (!user || !user.email) {
      alert("Please sign in with Google before liking the post.");
      return;
    }
    const uid = encEmail(user.email);
    const userLikeRef = userLikesCollection(uid);

    try {
      await runTransaction(db, async (tx) => {
        const metaSnap = await tx.get(likesDocRef);
        if (!metaSnap.exists()) {
          tx.set(likesDocRef, { count: 0 });
        }
        const userSnap = await tx.get(userLikeRef);

        if (userSnap.exists()) {
          const currentCount = (metaSnap.exists() && metaSnap.data().count) ? metaSnap.data().count : 0;
          const newCount = Math.max(0, currentCount - 1);
          tx.update(likesDocRef, { count: newCount });
          tx.delete(userLikeRef);
        } else {
          const currentCount = (metaSnap.exists() && metaSnap.data().count) ? metaSnap.data().count : 0;
          tx.update(likesDocRef, { count: currentCount + 1 });
          tx.set(userLikeRef, { email: user.email, name: user.name || null, time: Date.now() });
        }
      });
    } catch (err) {
      console.error("Like toggle failed:", err);
      alert("Could not update like. Try again.");
    }
  }

  // Comments: realtime listener with error callback
  function initCommentsListener() {
    try {
      const q = query(commentsCollectionRef, orderBy("time", "asc"));
      onSnapshot(q, (snapshot) => {
        if (!commentList) return;
        commentList.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const c = docSnap.data();
          const li = document.createElement("li");
          const time = new Date(c.time).toLocaleString("en-IN", {
            day: "2-digit", month: "short", year: "numeric", hour: "2-digit", minute: "2-digit"
          });
          li.innerHTML =
            "<strong>" + (c.author || "Anonymous") + "</strong>: " +
            (c.text || "") +
            '<span class="comment-timestamp">' + time + "</span>";
          commentList.appendChild(li);
        });
        log("[VAJRA DEBUG] comments snapshot size:", snapshot.size);
      }, (error) => {
        console.error("[VAJRA ERROR] comments onSnapshot failed:", error);
        alert("Comments realtime listener failed: " + (error && error.message || error));
      });
    } catch (err) {
      console.error("[VAJRA ERROR] initCommentsListener threw:", err);
    }
  }

  // Save comment (requires Firebase-authenticated user)
  async function saveCommentToFirestore(text) {
    const user = window.loggedUser;
    if (!user || !user.email) {
      alert("Please sign in with Google before posting a comment.");
      return;
    }
    try {
      await addDoc(commentsCollectionRef, {
        author: user.name || "Anonymous",
        email: user.email,
        text: text,
        time: Date.now()
      });
    } catch (err) {
      console.error("Failed to save comment:", err);
      alert("Could not post comment. Try again.");
    }
  }

  // Attach DOM events
  if (likeBtnCard) likeBtnCard.addEventListener("click", toggleLikeFirestore);
  if (likeBtnFull) likeBtnFull.addEventListener("click", toggleLikeFirestore);

  if (commentForm) {
    commentForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = (commentInput && commentInput.value || "").trim();
      if (!text) return;
      // Require sign-in
      if (!window.loggedUser) {
        alert("Please sign in with Google before posting a comment.");
        return;
      }
      await saveCommentToFirestore(text);
      if (commentInput) commentInput.value = "";
    });
  }

  if (commentLinkCard) {
    commentLinkCard.onclick = function () {
      if (fullBlog) fullBlog.style.display = "block";
      setTimeout(function () {
        if (commentsSection) commentsSection.scrollIntoView({ behavior: "smooth" });
      }, 200);
    };
  }

  // Listen for auth changes to update UI
  window.addEventListener('vajra:auth-changed', updateUserLikeUI);

  // Initialize features
  initLikes();
  initCommentsListener();

  // End of module
</script>


  <!-- Your original front-end behaviors (read more, share, etc.) -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const readMoreBtn = document.getElementById("read-more-btn");
      const readLessBtn = document.getElementById("read-less-btn");
      const fullBlog    = document.getElementById("full-blog");
      const topSection  = document.getElementById("top");

      readMoreBtn.onclick = () => {
        fullBlog.style.display = "block";
        fullBlog.scrollIntoView({ behavior: "smooth" });
      };

      readLessBtn.onclick = () => {
        topSection.scrollIntoView({ behavior: "smooth" });
        setTimeout(() => {
          fullBlog.style.display = "none";
        }, 350);
      };

      /* ---------------- SHARE SYSTEM ---------------- */
      const shareLinkCard = document.getElementById("share-link-card");
      const shareBtnFull  = document.getElementById("share-btn-full");

      function sharePost() {
        const url = window.location.href;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url)
            .then(() => alert("üîó Blog link copied to clipboard!"))
            .catch(() => alert("Could not copy link. Please copy it manually: " + url));
        } else {
          alert("Copy this link: " + url);
        }
      }

      if (shareLinkCard) shareLinkCard.onclick = sharePost;
      if (shareBtnFull) shareBtnFull.onclick  = sharePost;
    });
  </script>
</body>
</html>
