<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>TEAM VAJRA - Drone Club | Blog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/assets/club-logo.jpg">
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Lexend Font -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand-maroon: #800000;
      --brand-yellow: #f7c275;
      --text-light: #ffffff;
      --text-muted: #e0e0e0;
      --bg-dark: #050608;
      --bg-card: #111318;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Lexend', sans-serif;
    }

    body {
      color: var(--text-light);
      overflow-x: hidden;
      background-image:
        linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.95)),
        url("assets/blog-bg-drones.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    /* ===== Header ===== */
    .header {
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      border-bottom: 2px solid var(--brand-maroon);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav {
      display: flex;
      justify-content: space-around;
      align-items: center;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand img {
      height: 50px;
      border-radius: 8px;
    }

    .title {
      font-size: 1.3em;
      font-weight: 700;
      color: var(--brand-yellow);
    }

    .nav a {
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      color: #fff;
      transition: color 0.3s, border-bottom 0.3s;
    }

    .nav a:hover {
      color: var(--brand-yellow);
      border-bottom: 2px solid var(--brand-yellow);
    }

    .nav a.active {
      color: var(--brand-yellow);
      border-bottom: 2px solid var(--brand-yellow);
    }

    /* ===== Page Wrapper ===== */
    .page-wrap {
      max-width: 1100px;
      margin: 40px auto 60px;
      padding: 0 20px;
    }

    .page-title {
      margin-bottom: 26px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 15px;
    }

    .page-title h1 {
      font-size: 2.1rem;
      color: var(--brand-yellow);
      margin-bottom: 6px;
    }

    .page-title p {
      color: var(--text-muted);
      font-size: 0.96rem;
    }

    .member-login-link {
      background: rgba(247, 194, 117, 0.1);
      border: 1px solid var(--brand-yellow);
      color: var(--brand-yellow);
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .member-login-link:hover {
      background: rgba(247, 194, 117, 0.2);
    }

    /* Auth Buttons */
    .auth-buttons {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .signed-in-name {
      color: var(--brand-yellow);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .sign-out-btn {
      background: transparent;
      border: 1px solid #666;
      color: #aaa;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .sign-out-btn:hover {
      border-color: #f44336;
      color: #f44336;
    }

    #userSignedIn {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* ===== Featured Card (preview) ===== */
    .featured-label {
      font-size: 0.8rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .featured-block {
      margin-bottom: 18px;
    }

    .featured-card {
      background: rgba(7, 8, 12, 0.98);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.85);
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      min-height: 260px;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .featured-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.9);
    }

    .featured-image {
      position: relative;
      overflow: hidden;
    }

    .featured-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform 0.4s ease;
    }

    .featured-card:hover .featured-image img {
      transform: scale(1.06);
    }

    .featured-content {
      padding: 22px 26px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: linear-gradient(135deg, #10121a, #08090e);
    }

    .featured-meta {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .featured-title {
      font-size: 1.55rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 10px;
    }

    .featured-title span {
      color: var(--brand-yellow);
    }

    .featured-excerpt {
      font-size: 0.92rem;
      color: var(--text-muted);
      line-height: 1.7;
    }

    .card-bottom {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      border-top: 1px solid rgba(247, 194, 117, 0.22);
      padding-top: 10px;
    }

    .card-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.82rem;
    }

    .card-actions button,
    .card-actions a {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      color: var(--text-muted);
      text-decoration: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: color 0.2s;
      font-size: 0.82rem;
    }

    .card-actions button:hover,
    .card-actions a:hover {
      color: var(--brand-yellow);
    }

    .card-actions button.liked {
      color: var(--brand-yellow);
      font-weight: 600;
    }

    .read-more-link {
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .read-more-link button {
      background: none;
      border: none;
      color: var(--brand-yellow);
      cursor: pointer;
      font-size: inherit;
      font-weight: inherit;
      letter-spacing: inherit;
    }

    .read-more-link button:hover {
      text-decoration: underline;
    }

    .like-count-card {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* ===== Full Blog Article ===== */
    .blog-post {
      margin-top: 30px;
      background: rgba(5, 6, 10, 0.96);
      border-radius: 14px;
      padding: 22px 24px;
      border: 1px solid rgba(247, 194, 117, 0.25);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.9);
      display: none;
    }

    .blog-post h2 {
      color: var(--brand-yellow);
      margin-bottom: 6px;
      font-size: 1.4rem;
    }

    .blog-meta {
      margin-bottom: 10px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .blog-image-inline {
      display: block;
      width: 100%;
      max-width: 480px;
      border-radius: 12px;
      margin: 10px auto 18px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.9);
    }

    .blog-post p {
      margin-bottom: 10px;
      color: var(--text-muted);
      line-height: 1.7;
      font-size: 0.95rem;
    }

    .blog-post ul,
    .blog-post ol {
      margin-left: 1.2rem;
      margin-bottom: 10px;
      color: var(--text-muted);
      font-size: 0.93rem;
      line-height: 1.7;
    }

    .blog-post h3 {
      margin-top: 10px;
      margin-bottom: 6px;
      font-size: 1.05rem;
      color: var(--brand-yellow);
    }

    /* Article byline */
    .article-byline {
      margin-top: 14px;
      font-size: 0.95rem;
      color: var(--text-muted);
      display: flex;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    .article-byline .by-prefix {
      color: var(--text-muted);
      font-weight: 500;
    }

    .article-byline .by-author {
      color: var(--brand-yellow);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .article-byline .by-author:hover {
      text-decoration: underline;
    }

    .article-byline .by-author h2 {
      font-size: inherit;
      font-weight: inherit;
      color: inherit;
      margin: 0;
      display: inline;
    }

    .article-byline .by-note {
      color: var(--text-light);
      font-weight: 400;
      font-size: 0.88rem;
    }

    /* ===== Engagement Bar ===== */
    .engagement-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 18px;
      padding-top: 12px;
      border-top: 1px solid rgba(247, 194, 117, 0.3);
    }

    .engagement-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .engagement-buttons button {
      border-radius: 999px;
      border: 1px solid rgba(247, 194, 117, 0.6);
      background: transparent;
      color: var(--text-light);
      padding: 6px 14px;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s, border-color 0.2s;
    }

    .engagement-buttons button:hover {
      background: rgba(247, 194, 117, 0.14);
      border-color: var(--brand-yellow);
      transform: translateY(-1px);
    }

    .engagement-buttons button.liked {
      background: var(--brand-yellow);
      color: #000;
      border-color: var(--brand-yellow);
    }

    .like-count {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    /* ===== Comments ===== */
    .comments-section {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed rgba(247, 194, 117, 0.35);
    }

    .comments-section h4 {
      font-size: 1rem;
      margin-bottom: 6px;
      color: var(--brand-yellow);
    }

    .comment-form textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 10px;
      border: 1px solid rgba(247, 194, 117, 0.4);
      background: rgba(0, 0, 0, 0.75);
      color: var(--text-light);
      padding: 8px 10px;
      font-size: 0.9rem;
      resize: vertical;
    }

    .comment-form button {
      margin-top: 6px;
      border-radius: 999px;
      border: none;
      background: var(--brand-maroon);
      color: #fff;
      padding: 6px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .comment-form button:hover {
      background: var(--brand-yellow);
      color: #000;
      transform: translateY(-1px);
    }

    .comment-list {
      list-style: none;
      margin-top: 10px;
    }

    .comment-list li {
      padding: 6px 8px;
      margin-bottom: 6px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.04);
      font-size: 0.88rem;
      color: var(--text-muted);
    }

    .comment-timestamp {
      display: block;
      font-size: 0.72rem;
      color: rgba(224, 224, 224, 0.7);
      margin-top: 2px;
    }

    .back-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 0.84rem;
    }

    .back-to-top a,
    .read-less button {
      color: var(--brand-yellow);
      background: none;
      border: none;
      cursor: pointer;
      text-decoration: none;
      font-size: inherit;
    }

    .back-to-top a:hover,
    .read-less button:hover {
      text-decoration: underline;
    }

    /* Share Modal */
    #shareModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .share-modal-content {
      background: var(--bg-card);
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 350px;
      border: 1px solid rgba(247, 194, 117, 0.3);
    }

    .share-modal-content h3 {
      color: var(--brand-yellow);
      margin-bottom: 20px;
    }

    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .share-buttons button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: transform 0.2s;
    }

    .share-buttons button:hover {
      transform: scale(1.05);
    }

    .share-buttons button[data-platform="whatsapp"] {
      background: #25D366;
      color: white;
    }

    .share-buttons button[data-platform="twitter"] {
      background: #1DA1F2;
      color: white;
    }

    .share-buttons button[data-platform="linkedin"] {
      background: #0077B5;
      color: white;
    }

    .share-buttons button[data-platform="gmail"] {
      background: #EA4335;
      color: white;
    }

    .share-close {
      margin-top: 15px;
      background: none;
      border: 1px solid var(--brand-yellow);
      color: var(--brand-yellow);
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Loading */
    .loading-blogs {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .loading-blogs .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(247, 194, 117, 0.2);
      border-top-color: var(--brand-yellow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ===== Footer ===== */
    footer {
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding-top: 30px;
      border-top: 2px solid var(--brand-maroon);
    }

    .footer-main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 40px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 30px;
    }

    .footer-column {
      flex: 1 1 250px;
    }

    .footer-column h4 {
      color: var(--brand-yellow);
      margin-bottom: 10px;
    }

    .footer-column p,
    .footer-column a {
      color: var(--text-muted);
      font-size: 14px;
      text-decoration: none;
      line-height: 1.6;
    }

    .footer-column a:hover {
      color: var(--brand-yellow);
    }

    .footer-bottom {
      text-align: center;
      padding: 12px;
      font-size: 13px;
    }

    .social-links img {
      height: 32px;
      margin-right: 10px;
      transition: transform 0.3s;
      filter: brightness(90%);
    }

    .social-links img:hover {
      transform: scale(1.1);
      filter: brightness(110%);
    }

    /* ===== Responsive ===== */
    @media (max-width: 900px) {
      .featured-card {
        grid-template-columns: 1fr;
      }

      .featured-image {
        max-height: 260px;
      }
    }
  </style>
</head>

<body>
  <!-- Google Identity config -->
  <div id="g_id_onload" data-client_id="865557876116-4lose7akf8na0sptm29nvvfp83dolmab.apps.googleusercontent.com"
    data-callback="onGoogleSignIn" data-auto_prompt="false">
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <div class="brand">
        <img src="/assets/club-logo.jpg" alt="Team Vajra logo">
        <div>
          <div class="title">TEAM VAJRA</div>
          <div style="font-size:12px;color:var(--text-muted)">Drone Club ¬∑ MMCOE</div>
        </div>
      </div>
      <a href="/index.html">Home</a>
      <a href="/achievements.html">Achievements</a>
      <a href="/drones.html">Drones</a>
      <a href="/gallery.html">Gallery</a>
      <a href="/team.html">Team</a>
      <a href="/blog.html" class="active">Blogs</a>
      <a href="/contact.html">Contact</a>
    </div>
  </header>

  <main class="page-wrap" id="top">
    <div class="page-title">
      <div>
        <h1>Flight Path: The Official Team Vajra Blog</h1>
        <p>Race recaps, build logs, and behind-the-scenes stories from the Team Vajra hangar.</p>
      </div>
      <div class="auth-buttons">
        <!-- Google Sign-In for Public Users (Like/Comment) -->
        <div id="googleSignInArea">
          <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="filled_black"
            data-text="signin_with" data-size="medium" data-logo_alignment="left">
          </div>
        </div>
        <!-- Signed-in User Display -->
        <div id="userSignedIn" style="display: none;">
          <span id="userName" class="signed-in-name"></span>
          <button id="signOutBtn" class="sign-out-btn">Sign Out</button>
        </div>
        <!-- Member Login (for Club Members to Post Blogs) -->
        <a href="/login.html" class="member-login-link">‚úçÔ∏è Member Login</a>
      </div>
    </div>

    <!-- FEATURED label -->
    <div class="featured-label">Featured</div>

    <!-- Dynamic Blog Container -->
    <div id="blogContainer">
      <div class="loading-blogs">
        <div class="spinner"></div>
        <p>Loading blogs...</p>
      </div>
    </div>
  </main>

  <!-- Share Modal -->
  <div id="shareModal">
    <div class="share-modal-content">
      <h3>Share this post</h3>
      <div class="share-buttons">
        <button data-platform="whatsapp">WhatsApp</button>
        <button data-platform="twitter">Twitter</button>
        <button data-platform="linkedin">LinkedIn</button>
        <button data-platform="gmail">Gmail</button>
      </div>
      <button class="share-close">Close</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-main">
      <div class="footer-column branding">
        <h4>TEAM VAJRA - RC Drone Club MMCOE</h4>
        <p>At Team Vajra, we aim to cater to industrial and social needs by developing skilled manpower in drone
          technology.</p>
      </div>

      <div class="footer-column contact">
        <h4>Contact Us</h4>
        <address>
          <p><strong>Email:</strong> <a href="mailto:teamvajra_rc@mmcoe.edu.in">teamvajra_rc@mmcoe.edu.in</a></p>
          <p><strong>Phone:</strong> Tanisha K.: +91 9307832052</p>
          <p><strong>Phone:</strong> Omkar B.: +91 7058819104</p>
        </address>
      </div>

      <div class="footer-column social">
        <h4>Follow Us</h4>
        <div class="social-links">
          <a href="https://www.instagram.com/teamvajra_mmcoe/" target="_blank"><img src="assets/insta-logo.png"
              alt="Instagram"></a>
          <a href="https://in.linkedin.com/company/team-vajra-mmcoe" target="_blank"><img src="assets/linkedin-logo.png"
              alt="LinkedIn"></a>
        </div>
        <p><strong>Location:</strong><br>Sr.No. 18, Plot No. 5/3, CTS No.205, Behind Vandevi Temple, Karve Nagar, Pune
          411052, Maharashtra, India.</p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>¬© 2025 TEAM VAJRA. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- Firebase & Dynamic Blog Loading -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getFirestore, doc, getDoc, setDoc,
      collection, addDoc, onSnapshot, query, orderBy, runTransaction, getDocs
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
    import {
      getAuth, signInWithCredential, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut as firebaseSignOut
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyChvColRVokPBbAOiXv8P26ScRyDxPJI2w",
      authDomain: "team-vajra.firebaseapp.com",
      projectId: "team-vajra",
      storageBucket: "team-vajra.firebasestorage.app",
      messagingSenderId: "865557876116",
      appId: "1:865557876116:web:9f0ee78cee3c157df75381",
      measurementId: "G-TN5CL22RSH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Auth state - toggle UI based on sign-in status
    onAuthStateChanged(auth, (user) => {
      const googleSignInArea = document.getElementById('googleSignInArea');
      const userSignedIn = document.getElementById('userSignedIn');
      const userName = document.getElementById('userName');

      if (user) {
        window.loggedUser = { name: user.displayName, email: user.email, picture: user.photoURL, uid: user.uid };
        // Hide sign-in button, show user info
        if (googleSignInArea) googleSignInArea.style.display = 'none';
        if (userSignedIn) userSignedIn.style.display = 'flex';
        if (userName) userName.textContent = `üë§ ${user.displayName || user.email}`;
      } else {
        window.loggedUser = null;
        // Show sign-in button, hide user info
        if (googleSignInArea) googleSignInArea.style.display = 'block';
        if (userSignedIn) userSignedIn.style.display = 'none';
      }
      window.dispatchEvent(new Event('vajra:auth-changed'));
    });

    // Google Sign-In callback (for button-based sign-in)
    window.onGoogleSignIn = async function (response) {
      try {
        if (!response?.credential) return;
        const firebaseCred = GoogleAuthProvider.credential(response.credential);
        await signInWithCredential(auth, firebaseCred);
      } catch (err) {
        console.error('Sign-in failed:', err);
      }
    };

    // Google Sign-In with Popup (triggered from Like/Comment buttons)
    const googleProvider = new GoogleAuthProvider();
    window.pendingAction = null; // Store pending action after sign-in

    async function signInWithGooglePopup() {
      try {
        await signInWithPopup(auth, googleProvider);
        return true;
      } catch (err) {
        if (err.code === 'auth/popup-closed-by-user') {
          console.log('Sign-in popup closed by user');
        } else {
          console.error('Sign-in failed:', err);
          alert('Sign-in failed. Please try again.');
        }
        return false;
      }
    }

    // Sign-out button handler
    document.addEventListener('DOMContentLoaded', () => {
      const signOutBtn = document.getElementById('signOutBtn');
      if (signOutBtn) {
        signOutBtn.addEventListener('click', async () => {
          try {
            await firebaseSignOut(auth);
          } catch (err) {
            console.error('Sign-out failed:', err);
          }
        });
      }
    });

    // Helper function to format date
    function formatDate(timestamp) {
      if (!timestamp) return 'Unknown';
      const date = new Date(timestamp);
      return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    }

    // Render a single blog card
    function renderBlogCard(blog, blogId) {
      const date = formatDate(blog.publishedAt);
      const slug = blog.slug || blogId;

      return `
        <div class="featured-block" data-post-id="${slug}">
          <section class="featured-card">
            <div class="featured-image">
              <img src="${blog.featuredImage || 'assets/blog-bg-drones.jpg'}" alt="${blog.title}">
            </div>
            <div class="featured-content">
              <div>
                <div class="featured-meta">${date} ¬∑ ${blog.category || 'General'}</div>
                <div class="featured-title">
                  <span>${blog.title || 'Untitled'}</span>
                </div>
                <p class="featured-excerpt">${blog.excerpt || ''}</p>
                <div class="article-byline">
                  <span class="by-prefix">~By</span>
                  <a class="by-author" href="${blog.authorLinkedIn || '#'}" target="_blank" rel="noopener noreferrer">
                    <h2>${blog.authorName || 'Team Vajra'}</h2>
                  </a>
                  <span class="by-note">(Click on the name to know more about this member)</span>
                </div>
              </div>

              <div class="card-bottom">
                <div>
                  <div class="like-count-card">
                    <span class="like-count" data-target="likes">0</span> likes
                  </div>
                  <div class="card-actions">
                    <button class="like-btn" data-action="toggle-like">‚ù§Ô∏è Like</button>
                    <a class="share-link" data-action="share" href="javascript:void(0);">Share</a>
                    <a class="comment-link" data-action="open-comments" href="javascript:void(0);">Post a Comment</a>
                  </div>
                </div>
                <div class="read-more-link">
                  <button class="read-more-btn" data-action="read-more">READ MORE</button>
                </div>
              </div>
            </div>
          </section>

          <!-- FULL BLOG ARTICLE -->
          <article class="blog-post">
            <h2>${blog.title || 'Untitled'}</h2>
            <div class="blog-meta">Published: ${date} ¬∑ Category: ${blog.category || 'General'}</div>

            ${blog.featuredImage ? `<img src="${blog.featuredImage}" alt="${blog.title}" class="blog-image-inline">` : ''}

            <div class="blog-content">${blog.content || ''}</div>

            <div class="article-byline">
              <span class="by-prefix">~By</span>
              <a class="by-author" href="${blog.authorLinkedIn || '#'}" target="_blank" rel="noopener noreferrer">
                <h2>${blog.authorName || 'Team Vajra'}</h2>
              </a>
              <span class="by-note">(Click on the name to know more about this member)</span>
            </div>

            <!-- Engagement -->
            <div class="engagement-bar">
              <div class="engagement-buttons">
                <button class="like-btn" data-action="toggle-like">‚ù§Ô∏è Like</button>
                <button class="share-btn" data-action="share">üîó Share</button>
              </div>
              <div class="like-count">
                <span class="like-count" data-target="likes">0</span> likes
              </div>
            </div>

            <!-- Comments -->
            <div class="comments-section">
              <h4>Comments</h4>

              <div class="google-login-area" style="margin-bottom:10px;">
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="medium"
                     data-theme="filled_black"
                     data-text="Sign in with Google"
                     data-shape="pill">
                </div>
              </div>

              <p class="user-status" style="font-size:14px;color:#f7c275;margin-top:5px;">
                Not logged in
              </p>

              <form class="comment-form" data-action="comment-form">
                <textarea class="comment-input" placeholder="Share your thoughts..."></textarea>
                <button type="submit">Post Comment</button>
              </form>

              <ul class="comment-list"></ul>
            </div>

            <div class="back-row">
              <div class="back-to-top">
                <a href="#top">‚Üë Back to top</a>
              </div>
              <div class="read-less">
                <button class="read-less-btn" data-action="read-less">READ LESS</button>
              </div>
            </div>
          </article>
        </div>
      `;
    }

    // Load blogs from Firestore
    async function loadBlogs() {
      const container = document.getElementById('blogContainer');

      try {
        const blogsRef = collection(db, 'blogs');
        const q = query(blogsRef, orderBy('publishedAt', 'desc'));
        const snapshot = await getDocs(q);

        if (snapshot.empty) {
          container.innerHTML = `
            <div class="loading-blogs">
              <p>No blogs published yet. Check back soon!</p>
            </div>
          `;
          return;
        }

        let html = '';
        let firstFeatured = true;

        snapshot.forEach((docSnap) => {
          const blog = docSnap.data();
          // Only show published blogs
          if (blog.status === 'published') {
            html += renderBlogCard(blog, docSnap.id);
            firstFeatured = false;
          }
        });

        if (!html) {
          container.innerHTML = `
            <div class="loading-blogs">
              <p>No blogs published yet. Check back soon!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = html;

        // Wire up all blog interactions
        wireAllBlogs();

        // Handle hash navigation
        handleHashNavigation();

      } catch (err) {
        console.error('Error loading blogs:', err);
        container.innerHTML = `
          <div class="loading-blogs">
            <p>Failed to load blogs. Please refresh the page.</p>
          </div>
        `;
      }
    }

    // Wire Firestore interactions for all blogs
    function wireAllBlogs() {
      const blocks = document.querySelectorAll('.featured-block[data-post-id]');
      blocks.forEach(block => {
        const slug = block.dataset.postId;
        if (slug) wirePostFirestore(slug, block);
        wirePostUI(slug, block);
      });
    }

    // Wire Firestore (likes/comments)
    function wirePostFirestore(postId, blockEl) {
      const likesDocRef = doc(db, "blogMeta", postId);
      const userLikesRef = (uid) => doc(db, "blogMeta", postId, "userLikes", uid);
      const commentsColRef = collection(db, "blogComments_" + postId);

      const likeBtns = blockEl.querySelectorAll('[data-action="toggle-like"], .like-btn');
      const likeCountEls = blockEl.querySelectorAll('.like-count[data-target="likes"]');
      const commentList = blockEl.querySelector('.comment-list');
      const userStatusEls = blockEl.querySelectorAll('.user-status');

      // Encode email for document ID
      function encEmail(e) { return encodeURIComponent(e).replace(/\./g, '%2E'); }

      // Init likes
      (async () => {
        try {
          const snap = await getDoc(likesDocRef);
          if (!snap.exists()) await setDoc(likesDocRef, { count: 0 });

          onSnapshot(likesDocRef, (s) => {
            if (!s.exists()) return;
            const c = s.data().count || 0;
            likeCountEls.forEach(el => el.textContent = c);
          });
        } catch (e) { console.error('Init likes error:', e); }
      })();

      // Update user like UI
      async function updateUserLikeUI() {
        try {
          const user = window.loggedUser;
          if (!user?.email) {
            likeBtns.forEach(b => b.classList.remove('liked'));
            userStatusEls.forEach(el => el.innerHTML = 'Not logged in');
            return;
          }
          const id = encEmail(user.email);
          const s = await getDoc(userLikesRef(id));
          const liked = s.exists();
          likeBtns.forEach(b => b.classList.toggle('liked', liked));
          userStatusEls.forEach(el => el.innerHTML = `Logged in as <b>${user.name || user.email}</b>`);
        } catch (e) { console.error('Update like UI error:', e); }
      }

      window.addEventListener('vajra:auth-changed', updateUserLikeUI);
      updateUserLikeUI();

      // Toggle like - triggers popup sign-in if not logged in
      async function toggleLike() {
        let user = window.loggedUser;

        // If not signed in, trigger Google Sign-In popup
        if (!user?.email) {
          const signedIn = await signInWithGooglePopup();
          if (!signedIn) return; // User cancelled sign-in

          // Wait a moment for auth state to update
          await new Promise(resolve => setTimeout(resolve, 500));
          user = window.loggedUser;
          if (!user?.email) return;
        }

        const uid = encEmail(user.email);
        try {
          await runTransaction(db, async (tx) => {
            const metaSnap = await tx.get(likesDocRef);
            if (!metaSnap.exists()) tx.set(likesDocRef, { count: 0 });
            const userSnap = await tx.get(userLikesRef(uid));
            const currentCount = metaSnap.exists() ? (metaSnap.data().count || 0) : 0;

            if (userSnap.exists()) {
              tx.update(likesDocRef, { count: Math.max(0, currentCount - 1) });
              tx.delete(userLikesRef(uid));
            } else {
              tx.update(likesDocRef, { count: currentCount + 1 });
              tx.set(userLikesRef(uid), { email: user.email, name: user.name, time: Date.now() });
            }
          });
        } catch (err) {
          console.error('Toggle like error:', err);
          alert('Could not update like. Try again.');
        }
      }

      likeBtns.forEach(b => b.addEventListener('click', toggleLike));

      // Comments listener
      try {
        const q = query(commentsColRef, orderBy('time', 'asc'));
        onSnapshot(q, (snapshot) => {
          if (!commentList) return;
          commentList.innerHTML = '';
          snapshot.forEach(ds => {
            const c = ds.data();
            const li = document.createElement('li');
            const time = new Date(c.time).toLocaleString('en-IN', {
              day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
            });
            li.innerHTML = `<strong>${c.author || 'Anonymous'}</strong>: ${c.text || ''}<span class="comment-timestamp">${time}</span>`;
            commentList.appendChild(li);
          });
        });
      } catch (e) { console.error('Comments listener error:', e); }

      // Comment form - triggers popup sign-in if not logged in
      const commentForm = blockEl.querySelector('.comment-form');
      const commentInput = blockEl.querySelector('.comment-input');

      if (commentForm && commentInput) {
        commentForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const text = commentInput.value.trim();
          if (!text) return;

          let user = window.loggedUser;

          // If not signed in, trigger Google Sign-In popup
          if (!user?.email) {
            const signedIn = await signInWithGooglePopup();
            if (!signedIn) return; // User cancelled sign-in

            // Wait a moment for auth state to update
            await new Promise(resolve => setTimeout(resolve, 500));
            user = window.loggedUser;
            if (!user?.email) return;
          }

          try {
            await addDoc(commentsColRef, {
              author: user.name || 'Anonymous',
              email: user.email,
              text,
              time: Date.now()
            });
            commentInput.value = '';
          } catch (err) {
            console.error('Post comment error:', err);
            alert('Could not post comment. Try again.');
          }
        });
      }
    }

    // Wire UI interactions
    function wirePostUI(slug, block) {
      const featuredCard = block.querySelector('.featured-card');
      const fullArticle = block.querySelector('.blog-post');
      const readMoreBtn = block.querySelector('[data-action="read-more"], .read-more-btn');
      const readLessBtn = block.querySelector('[data-action="read-less"], .read-less-btn');
      const shareBtns = block.querySelectorAll('[data-action="share"], .share-link, .share-btn');
      const commentLinks = block.querySelectorAll('[data-action="open-comments"], .comment-link');

      // Click card to open
      if (featuredCard && fullArticle) {
        featuredCard.addEventListener('click', (e) => {
          if (e.target.closest('button') || e.target.closest('a')) return;
          fullArticle.style.display = 'block';
          fullArticle.scrollIntoView({ behavior: 'smooth' });
          history.replaceState(null, '', '#' + slug);
        });
      }

      // Read more
      if (readMoreBtn && fullArticle) {
        readMoreBtn.addEventListener('click', () => {
          fullArticle.style.display = 'block';
          fullArticle.scrollIntoView({ behavior: 'smooth' });
          history.replaceState(null, '', '#' + slug);
        });
      }

      // Read less
      if (readLessBtn && fullArticle) {
        readLessBtn.addEventListener('click', () => {
          document.getElementById('top')?.scrollIntoView({ behavior: 'smooth' });
          setTimeout(() => { fullArticle.style.display = 'none'; }, 350);
          history.replaceState(null, '', window.location.pathname);
        });
      }

      // Share
      shareBtns.forEach(btn => {
        btn.addEventListener('click', () => sharePost(slug));
      });

      // Comment link
      commentLinks.forEach(cl => {
        cl.addEventListener('click', () => {
          if (fullArticle) {
            fullArticle.style.display = 'block';
            setTimeout(() => {
              const cs = fullArticle.querySelector('.comments-section');
              if (cs) cs.scrollIntoView({ behavior: 'smooth' });
            }, 200);
          }
        });
      });
    }

    // Share modal
    function sharePost(slug) {
      const base = location.href.split('#')[0];
      const url = base + '#' + slug;
      const text = "üöÅ Check out this blog from Team Vajra";

      if (navigator.share) {
        navigator.share({ title: "Team Vajra Blog", text, url }).catch(() => { });
        return;
      }

      const modal = document.getElementById('shareModal');
      modal.style.display = 'flex';

      modal.querySelectorAll('[data-platform]').forEach(btn => {
        btn.onclick = () => {
          const p = btn.dataset.platform;
          const eURL = encodeURIComponent(url);
          const eText = encodeURIComponent(text);

          if (p === 'whatsapp') window.open(`https://wa.me/?text=${eText}%20${eURL}`);
          if (p === 'twitter') window.open(`https://twitter.com/intent/tweet?text=${eText}&url=${eURL}`);
          if (p === 'linkedin') window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${eURL}`);
          if (p === 'gmail') window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${eText}&body=${eURL}`);

          modal.style.display = 'none';
        };
      });

      modal.querySelector('.share-close').onclick = () => {
        modal.style.display = 'none';
      };
    }

    // Handle hash navigation
    function handleHashNavigation() {
      const hash = location.hash.replace('#', '');
      if (hash) {
        const slug = hash.replace('-comments', '');
        const block = document.querySelector(`.featured-block[data-post-id="${slug}"]`);
        const openComments = hash.endsWith('-comments');

        if (block) {
          const article = block.querySelector('.blog-post');
          if (article) {
            article.style.display = 'block';
            setTimeout(() => {
              if (openComments) {
                const cs = article.querySelector('.comments-section');
                if (cs) cs.scrollIntoView({ behavior: 'smooth' });
              } else {
                article.scrollIntoView({ behavior: 'smooth' });
              }
            }, 200);
          }
        }
      }
    }

    // Initialize
    loadBlogs();
  </script>
</body>

</html>